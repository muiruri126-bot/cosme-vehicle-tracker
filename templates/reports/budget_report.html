{% extends "base.html" %}
{% block title %}Budget / Fuel Cost Report – COSME Vehicle Tracker{% endblock %}
{% block content %}
<h2 class="mb-4"><i class="bi bi-piggy-bank"></i> Budget &amp; Fuel Cost Report</h2>

<p class="text-muted">Fuel cost summary grouped by Project Code (completed trips only).</p>

{% if rows %}
<div class="table-responsive">
  <table class="table table-striped table-hover align-middle">
    <thead class="table-light">
      <tr>
        <th>Project Code</th>
        <th>Trips</th>
        <th>Total Distance (km)</th>
        <th>Total Fuel (L)</th>
        <th>Total Fuel Cost</th>
      </tr>
    </thead>
    <tbody>
      {% for row in rows %}
      <tr>
        <td><strong>{{ row.project_code or '(No code)' }}</strong></td>
        <td>{{ row.trip_count }}</td>
        <td>{{ row.total_distance or 0 }}</td>
        <td>{{ "%.1f"|format(row.total_fuel) if row.total_fuel else '–' }}</td>
        <td>{{ "%.2f"|format(row.total_cost) if row.total_cost else '–' }}</td>
      </tr>
      {% endfor %}
    </tbody>
    <tfoot class="table-dark">
      <tr>
        <td><strong>Grand Total</strong></td>
        <td><strong>{{ rows | sum(attribute='trip_count') }}</strong></td>
        <td><strong>{{ rows | sum(attribute='total_distance') or 0 }}</strong></td>
        <td><strong>{{ "%.1f"|format(rows | sum(attribute='total_fuel') or 0) }}</strong></td>
        <td><strong>{{ "%.2f"|format(rows | sum(attribute='total_cost') or 0) }}</strong></td>
      </tr>
    </tfoot>
  </table>
</div>
{% else %}
<div class="alert alert-info">
  No completed trips with fuel cost data found.
</div>
{% endif %}
{% endblock %}
